<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Installation" href="installation.html" /><link rel="prev" title="Contents" href="index.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.07.19 -->
        <title>McSAS3 (v1.0.6) - McSAS3 1.0.6 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=34bb78ad" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">McSAS3 1.0.6 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">McSAS3 1.0.6 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">McSAS3 (v1.0.6)</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="reference/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="reference/autosummary/mcsas3.html">mcsas3</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">CHANGELOG</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/BAMresearch/McSAS3">View on GitHub</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/readme.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="mcsas3-v1-0-6">
<h1>McSAS3 (v1.0.6)<a class="headerlink" href="#mcsas3-v1-0-6" title="Link to this heading">¶</a></h1>
<p><a class="reference external" href="https://pypi.org/project/mcsas3"><img alt="PyPI Package latest release" src="https://img.shields.io/pypi/v/mcsas3.svg" /></a>
<a class="reference external" href="https://github.com/BAMresearch/McSAS3/compare/v1.0.6...main"><img alt="Commits since latest release" src="https://img.shields.io/github/commits-since/BAMresearch/McSAS3/v1.0.6.svg" /></a>
<a class="reference external" href="https://en.wikipedia.org/wiki/GPL-3.0-or-later"><img alt="License" src="https://img.shields.io/pypi/l/mcsas3.svg" /></a>
<a class="reference external" href="https://pypi.org/project/mcsas3"><img alt="Supported versions" src="https://img.shields.io/pypi/pyversions/mcsas3.svg" /></a>
<a class="reference external" href="https://pypi.org/project/mcsas3#files"><img alt="PyPI Wheel" src="https://img.shields.io/pypi/wheel/mcsas3.svg" /></a>
<a class="reference external" href="https://pypi.org/project/mcsas3/"><img alt="Weekly PyPI downloads" src="https://img.shields.io/pypi/dw/mcsas3.svg" /></a>
<a class="reference external" href="https://github.com/BAMresearch/McSAS3/actions/workflows/ci-cd.yml"><img alt="Continuous Integration and Deployment Status" src="https://github.com/BAMresearch/McSAS3/actions/workflows/ci-cd.yml/badge.svg" /></a>
<a class="reference external" href="https://BAMresearch.github.io/McSAS3/coverage-report/"><img alt="Coverage report" src="https://img.shields.io/endpoint?url=https://BAMresearch.github.io/McSAS3/coverage-report/cov.json" /></a></p>
<p>McSAS3 (a refactored version of the original McSAS) fits scattering patterns to obtain size distributions without assumptions on the size distribution form. The refactored version has some neat features:</p>
<ul class="simple">
<li><p>Multiprocessing is included, spread out over as many cores as number of repetitions!</p></li>
<li><p>Full state of the optimization is stored in an organized HDF5 state file.</p></li>
<li><p>Histogramming is separate from optimization and a result can be re-histogrammed as many times as desired.</p></li>
<li><p>SasModels allow a wide range of models to be used</p></li>
<li><p>If SasModels does not work (e.g. because of gcc compiler issues on Windows or Mac), an internal sphere model is supplied</p></li>
<li><p>Simulated data of the scattering of a special shape can also be used as a McSAS fitting model. Your models are infinite!</p></li>
<li><p>2D fitting also works.</p></li>
</ul>
<p><img alt="Example results plot" src="https://user-images.githubusercontent.com/5449929/156196219-72472a71-bbd6-4506-a12b-134216deeef6.jpg" /></p>
<section id="important-note">
<h2>Important note:<a class="headerlink" href="#important-note" title="Link to this heading">¶</a></h2>
<p>Due to an issue with sasmodels when using OpenCL: if you see problems with the fit not matching up at all to the data, disable sasmodels opencl by setting the environment variable SAS_OPENCL=none in the terminal you are launching McSAS3 from.</p>
</section>
<section id="current-state">
<h2>Current state<a class="headerlink" href="#current-state" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>McSAS3 now has an internal sphere model as well, and so no longer absolutely requires SasModels for normal runs.</p></li>
<li><p>There are launchers that can work from the command line, for optimization and (separately) histogramming. These use minimal configuration files for setting up the different parts of the code. Adjust these for your output files and optimization requirements, and then you can use these to automatically provide a McSAS3 analysis for every measurement.</p></li>
<li><p>Currently, it reads three-column ascii / CSV files, or NeXus/HDF5 files. example read configurations are provided.</p></li>
<li><p>Observability limits are not included yet</p></li>
<li><p>A GUI is not available (yet).</p></li>
<li><p>Some bugs remain. Feel free to add bugs to the issues. They will be fixed as time permits.</p></li>
</ol>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>This package can be installed by ensuring that</p>
<ol class="arabic simple">
<li><p>you have SasModels (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">sasmodels</span></code>) and</p></li>
<li><p>the most recent 21.4+ version of <code class="docutils literal notranslate"><span class="pre">attrs</span></code>, as well as <code class="docutils literal notranslate"><span class="pre">pandas</span></code>. After that, you can do <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/BAMresearch/McSAS3.git</span></code> in an appropriate location to install McSAS3.</p></li>
<li><p>On Windows, if you want to use the sasmodels library, it is highly recommended to run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">tinycc</span></code> so that there’s a compatible compiler available.</p></li>
</ol>
<p>Install <em>McSAS3</em> in your Python environment by running:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install mcsas3
</pre></div>
</div>
<p>You can also install the in-development version with::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install git+https://github.com/BAMresearch/McSAS3.git
</pre></div>
</div>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p>To run the optimizer from the command line using the test settings and test data, you can run the following command <code class="docutils literal notranslate"><span class="pre">mcsas3-runner</span></code>. This stores the optimization result in a file named test.nxs. This can subsequently be histogrammed and plotted using the following commmand:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mcsas3-histogrammer -r test.nxs
</pre></div>
</div>
<p>This is, of course, a mere test case. The result should look like the Figure shown earlier.</p>
<p>To do the same for real measurements, you need to configure McSAS3 by supplying it with three configuration files (two for the optimization, one for the histogramming):</p>
<section id="data-read-configuration-file">
<h3>Data read configuration file<a class="headerlink" href="#data-read-configuration-file" title="Link to this heading">¶</a></h3>
<p>This file contains the parameters necessary to read a data file. The example file for reading a three-column ASCII file, for example, contains:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">---</span><span class="w"> </span><span class="c1"># configuration used to read files into McSAS3. this is assumed to be a 1D file in csv format</span>
<span class="w">    </span><span class="c1"># Note that the units are assumed to be 1/(m sr) for I and 1/nm for Q</span>
<span class="w">    </span><span class="nt">nbins</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">dataRange</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span><span class="w"> </span><span class="c1"># minimum</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.inf</span><span class="w"> </span><span class="c1"># maximum. Positive infinity starts with a dot. negative infinity is -.inf</span>
<span class="w">    </span><span class="nt">csvargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sep</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;;&quot;</span>
<span class="w">      </span><span class="nt">header</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># null translates to a Python &quot;None&quot;, used for files without a header</span>
<span class="w">      </span><span class="nt">names</span><span class="p">:</span><span class="w"> </span><span class="c1"># column names</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Q&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;I&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ISigma&quot;</span>
</pre></div>
</div>
<p>Here, <em>nbins</em> is the number of binned datapoints to apply to the data clipped to within the dataRange Q limits. We normally rebin the data to reduce the number of datapoints used for the optimization procedure. Typically 100 datapoints per decade is more than sufficient. The uncertainties are propagated and means calculated from the datapoints within a bin.</p>
<p>The <em>csvargs</em> is the dictionary of options passed on to the Pandas.from_csv function. The thus loaded columns should at least contain columns named ‘Q’, ‘I’, and ‘ISigma’ (the uncertainty on I).</p>
<p>You can also directly load NeXus or HDF5 files, for example you can directly load the processed files that come out of the DAWN software package. The file read configuration for a NeXus or HDF5 file is slightly different. The reader can follow either the ‘default’ attributes to the data to use, or you can supply a dictionary of HDF5 paths to the datasets to fit (this is the more robust option). For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">---</span><span class="w"> </span><span class="c1"># configuration used to read nexus files into McSAS3. this is assumed to be a 1D file in nexus</span>
<span class="w">    </span><span class="c1"># Note that the units are assumed to be 1/(m sr) for I and 1/nm for Q</span>
<span class="w">    </span><span class="c1"># if necessary, the paths to the datasets can be indicated.</span>
<span class="w">    </span><span class="nt">nbins</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">dataRange</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span><span class="w"> </span><span class="c1"># minimum</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span><span class="w"> </span><span class="c1"># maximum for this dataset. Positive infinity starts with a dot. negative infinity is -.inf</span>
<span class="w">    </span><span class="nt">pathDict</span><span class="p">:</span><span class="w"> </span><span class="c1"># optional, if not provided will follow the &quot;default&quot; attributes in the nexus file</span>
<span class="w">      </span><span class="nt">Q</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/entry/result/Q&#39;</span>
<span class="w">      </span><span class="nt">I</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/entry/result/I&#39;</span>
<span class="w">      </span><span class="nt">ISigma</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/entry/result/ISigma&#39;</span>
</pre></div>
</div>
</section>
<section id="optimization-parameters">
<h3>Optimization parameters<a class="headerlink" href="#optimization-parameters" title="Link to this heading">¶</a></h3>
<p>The second required configuration file sets the optimization parameters for the Monte Carlo approach. The default settings (shown below) can be largely maintained. You might, however, want to adjust the convergence criterion ‘convCrit’ for datasets where the uncertainty estimate is not an accurate representation of the datapoint uncertainty. ‘nrep’ indicates the number of independent optimizations that are run. For tests, we recommend using a small number, from 2-10. For publication-quality averages, however, we usually increase this to 50 or 100 repetitions to improve the averages and the uncertainty estimates on the final distribution. ‘nCores’ defines the maximum number of threads to use, the repetitions are split over this number of threads.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nt">modelName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mcsas_sphere&quot;</span>
<span class="w">    </span><span class="nt">nContrib</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
<span class="w">    </span><span class="nt">modelDType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span>
<span class="w">    </span><span class="nt">fitParameterLimits</span><span class="p">:</span>
<span class="w">      </span><span class="nt">radius</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;auto&#39;</span><span class="w"> </span><span class="c1"># automatic determination of radius limits based on the data limits. This is replaced in McHat by actual limits</span>
<span class="w">      </span><span class="c1">#   - 3.14</span>
<span class="w">      </span><span class="c1">#   - 314</span>
<span class="w">    </span><span class="nt">staticParameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sld</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">33.4</span><span class="w"> </span><span class="c1"># units of 1e-6 A^-2</span>
<span class="w">      </span><span class="nt">sld_solvent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">maxIter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100000</span>
<span class="w">    </span><span class="nt">convCrit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">nRep</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">nCores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
<p>McSAS3 is set up so that if the maximum number of iterations ‘maxIter’ is reached before the convergence criterion is reached, the result is still stored in the McSAS output state file, and can still be histogrammed. This is done so you can use McSAS3 as a part of a data processing workflow, to give you a first result even if the McSAS settings or data has not been configured perfectly yet.</p>
<p>the fit parameter limits are best left to automatic, in this case the size range for the MC optimization is automatically set by the Q range of your data. This requires the data to be valid throughout its loaded data or preset data limits. Likewise a zero Q value is to be avoided for automatic size range determination.</p>
<p>As for models, the mcsas_sphere model is an internal sphere model that does not rely on a functioning SasModels. Other model names are discovered within the SasModel library.</p>
<p>Absolute intensity calculation has been lightly tested for data in input units of 1/nm for Q and 1/(m sr) for I. In this case, the SLD should be entered in units of $1e-6 1/A^2$,  However, bugs in absolute volume determination may remain for a while.</p>
</section>
<section id="histogramming-parameters">
<h3>Histogramming parameters<a class="headerlink" href="#histogramming-parameters" title="Link to this heading">¶</a></h3>
<p>The histogramming configuration example looks like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">---</span><span class="w"> </span><span class="c1"># Histogramming configuration:</span>
<span class="w">      </span><span class="nt">parameter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;radius&quot;</span>
<span class="w">      </span><span class="nt">nBin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">      </span><span class="nt">binScale</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;log&quot;</span>
<span class="w">      </span><span class="nt">presetRangeMin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.14</span>
<span class="w">      </span><span class="nt">presetRangeMax</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">314</span>
<span class="w">      </span><span class="nt">binWeighting</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vol&quot;</span>
<span class="w">      </span><span class="nt">autoRange</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">   </span><span class="w w-Error"> </span><span class="l l-Scalar l-Scalar-Plain">---</span><span class="w"> </span><span class="c1"># second histogram</span>
<span class="w">      </span><span class="nt">parameter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;radius&quot;</span>
<span class="w">      </span><span class="nt">nBin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">      </span><span class="nt">binScale</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;linear&quot;</span>
<span class="w">      </span><span class="nt">presetRangeMin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">      </span><span class="nt">presetRangeMax</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">      </span><span class="nt">binWeighting</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vol&quot;</span>
<span class="w">      </span><span class="nt">autoRange</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<p>Lastly, the histogramming ranges have to be configured. This can be done by adding as many entries as requiredd in the histogramming configuration yaml file. Parameter ranges can be set automatic (using the autoRange flag, thus ignoring the presetRangeMin and presetRangeMax values), or by setting fixed limits and leaving autoRange as False.</p>
<p>at the moment, the only bin weighting scheme implemented is the volume-weighted binning scheme, as it is the most reliable. Please leave an issue ticket if you need number-weighting to return.</p>
<p>For each histogramming range, histogram-independent population statistics are also calculated and provided, both in the PDF as well as in the McSAS output state file. These can be read automatically from there later on.</p>
</section>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h2>
<p>https://BAMresearch.github.io/McSAS3</p>
</section>
<section id="development">
<h2>Development<a class="headerlink" href="#development" title="Link to this heading">¶</a></h2>
<section id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h3>
<p>See which tests are available (arguments after <code class="docutils literal notranslate"><span class="pre">--</span></code> get passed to <em>pytest</em> which runs the tests):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tox -e py -- --co
</pre></div>
</div>
<p>Run a specific test only:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tox -e py -- -k &lt;test_name from listing before&gt;
</pre></div>
</div>
<p>Run all tests with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tox -e py
</pre></div>
</div>
</section>
<section id="project-template">
<h3>Project template<a class="headerlink" href="#project-template" title="Link to this heading">¶</a></h3>
<p>Update the project configuration from the <em>copier</em> template:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>copier update --trust --skip-answered
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="installation.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Installation</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2018-2025, Brian R. Pauw and Ingo Breßler
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Jul 25, 2025 (git 215a10a)</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">McSAS3 (v1.0.6)</a><ul>
<li><a class="reference internal" href="#important-note">Important note:</a></li>
<li><a class="reference internal" href="#current-state">Current state</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#data-read-configuration-file">Data read configuration file</a></li>
<li><a class="reference internal" href="#optimization-parameters">Optimization parameters</a></li>
<li><a class="reference internal" href="#histogramming-parameters">Histogramming parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
<li><a class="reference internal" href="#development">Development</a><ul>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#project-template">Project template</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=e2a723ec"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>